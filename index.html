<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>วิเคราะห์การบริโภคอาหาร</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        input, select {
            width: 100%;
            font-family: 'Prompt', sans-serif;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>สสอ.โนนสะอาด ชวนคนโนนสะอาดนับคาร์บ</h1>
    <form id="nutritionForm">
        <select id="gender" required>
            <option value="">เลือกเพศ</option>
            <option value="male">ชาย</option>
            <option value="female">หญิง</option>
        </select>
        
        <input type="number" id="age" placeholder="อายุ (ปี)" required>
        <input type="number" id="weight" placeholder="น้ำหนัก (กก.)" required>
        <input type="number" id="height" placeholder="ส่วนสูง (ซม.)" required>
        
        <select id="activity" required>
            <option value="">ระดับการออกกำลังกาย</option>
            <option value="sedentary">นั่งทำงานตลอดวัน</option>
            <option value="light">ออกกำลังกายน้อย</option>
            <option value="moderate">ออกกำลังกายปานกลาง</option>
            <option value="active">ออกกำลังกายมาก</option>
            <option value="veryActive">ออกกำลังกายอย่างหนัก</option>
        </select>
        
        <button type="submit">คำนวณ</button>
    </form>

    <script>
        // ฟังก์ชันคำนวณโภชนาการ
        function calculateNutrition(gender, age, weight, height, activity) {
            // คำนวณ BMR (Basal Metabolic Rate)
            let bmr;
            if (gender === 'male') {
                bmr = 66 + (13.7 * weight) + (5 * height) - (6.8 * age);
            } else {
                bmr = 655 + (9.6 * weight) + (1.8 * height) - (4.7 * age);
            }

            // คำนวณ TDEE (Total Daily Energy Expenditure) ตามระดับกิจกรรม
            const activityMultipliers = {
                sedentary: 1.2,
                light: 1.375,
                moderate: 1.55,
                active: 1.725,
                veryActive: 1.9
            };
            const tdee = bmr * activityMultipliers[activity];

            // คำนวณ Macronutrients (โปรตีน ไขมัน คาร์โบไฮเดรต)
            const proteinGrams = Math.round((tdee * 0.3) / 4); // 30% ของพลังงานจากโปรตีน
            const fatGrams = Math.round((tdee * 0.25) / 9);    // 25% ของพลังงานจากไขมัน
            const carbGrams = Math.round((tdee * 0.45) / 4);   // 45% ของพลังงานจากคาร์โบไฮเดรต

            return {
                macronutrients: {
                    protein: { grams: proteinGrams },
                    fat: { grams: fatGrams },
                    carbs: { grams: carbGrams }
                }
            };
        }

        // ฟังก์ชันคำนวณคาร์บหน่วย
        function calculateCarbUnits(carbGrams) {
            // คาร์บ 1 หน่วย = 15 กรัมคาร์โบไฮเดรต
            return Math.round(carbGrams / 15);
        }

        // ฟังก์ชันกระจายคาร์บหน่วยตามมื้ออาหาร
        function getCarbDistribution(carbUnits) {
            return {
                breakfast: Math.round(carbUnits * 0.3), // มื้อเช้า 30%
                lunch: Math.round(carbUnits * 0.4),     // มื้อกลางวัน 40%
                dinner: Math.round(carbUnits * 0.3)     // มื้อเย็น 30%
            };
        }

        // ฟังก์ชันสร้างคำแนะนำอาหาร
        function generateDetailedFoodRecommendations(carbDistribution) {
            return {
                breakfast: [
                    `ข้าวสวย ${Math.floor(carbDistribution.breakfast * 0.8)} ทัพพี (${Math.floor(carbDistribution.breakfast * 0.8)} คาร์บ)`,
                    `ขนมปัง ${Math.floor(carbDistribution.breakfast * 0.6)} แผ่น (${Math.floor(carbDistribution.breakfast * 0.6)} คาร์บ)`,
                    โจ๊ก ${Math.floor(carbDistribution.breakfast * 0.7)} ถ้วย (${Math.floor(carbDistribution.breakfast * 0.7)} คาร์บ)
                ],
                lunch: [
                    `ข้าวสวย ${Math.floor(carbDistribution.lunch * 0.9)} ทัพพี (${Math.floor(carbDistribution.lunch * 0.9)} คาร์บ)`,
                    `ก๋วยเตี๋ยว ${Math.floor(carbDistribution.lunch * 0.8)} ถ้วย (${Math.floor(carbDistribution.lunch * 0.8)} คาร์บ)`,
                    ข้าวต้ม ${Math.floor(carbDistribution.lunch * 0.7)} ถ้วย (${Math.floor(carbDistribution.lunch * 0.7)} คาร์บ)
                ],
                dinner: [
                    `ข้าวกล้อง ${Math.floor(carbDistribution.dinner * 0.9)} ทัพพี (${Math.floor(carbDistribution.dinner * 0.9)} คาร์บ)`,
                    `สปาเก็ตตี้ ${Math.floor(carbDistribution.dinner * 0.8)} จาน (${Math.floor(carbDistribution.dinner * 0.8)} คาร์บ)`,
                    ผักรวม ${Math.floor(carbDistribution.dinner * 0.5)} ทัพพี (${Math.floor(carbDistribution.dinner * 0.5)} คาร์บ)
                ]
            };
        }

        // จัดการการส่งฟอร์ม
        document.getElementById('nutritionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const gender = document.getElementById('gender').value;
            const age = parseFloat(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const activity = document.getElementById('activity').value;
            
            // คำนวณโภชนาการ
            const nutrition = calculateNutrition(gender, age, weight, height, activity);
            
            // คำนวณหน่วยคาร์บ
            const carbUnits = calculateCarbUnits(nutrition.macronutrients.carbs.grams);
            const carbDistribution = getCarbDistribution(carbUnits);
            const foodRecommendations = generateDetailedFoodRecommendations(carbDistribution);
            
            // แสดงผลลัพธ์ด้วย SweetAlert2
            Swal.mixin({
                confirmButtonText: 'ถัดไป &rarr;',
                showCancelButton: true,
                cancelButtonText: 'ปิด',
                progressSteps: ['1', '2']
            }).queue([
                {
                    title: 'ข้อมูลโภชนาการ',
                    html: `
                        <h3>โปรตีน</h3>
                        <p><strong style="color:green;">${nutrition.macronutrients.protein.grams} กรัม</strong></p>
                        
                        <h3>ไขมัน</h3>
                        <p><strong style="color:blue;">${nutrition.macronutrients.fat.grams} กรัม</strong></p>
                        
                        <h3>คาร์โบไฮเดรต</h3>
                        <p><strong style="color:red;">${nutrition.macronutrients.carbs.grams} กรัม</strong></p>
                        
                        <h3>จำนวนคาร์บ (1 คาร์บ = 15 กรัม)</h3>
                        <p><strong style="color:purple;">${carbUnits} หน่วย</strong></p>
                    `,
                    background: '#f0f0f0',
                    confirmButtonColor: '#6f42c1'
                },
                {
                    title: `คำแนะนำการบริโภคอาหารใน 1 วัน (${carbUnits} คาร์บ)`,
                    html: `
                        <h4>มื้อเช้า (${carbDistribution.breakfast} คาร์บ):</h4>
                        <p>${foodRecommendations.breakfast.join(' หรือ ')}</p>
                        <h4>มื้อกลางวัน (${carbDistribution.lunch} คาร์บ):</h4>
                        <p>${foodRecommendations.lunch.join(' หรือ ')}</p>
                        <h4>มื้อเย็น (${carbDistribution.dinner} คาร์บ):</h4>
                        <p>${foodRecommendations.dinner.join(' หรือ ')}</p>
                    `,
                    background: '#fff3cd',
                    confirmButtonColor: '#ffc107'
                }
            ]).then((result) => {
                if (result.value) {
                    Swal.fire({
                        title: 'วิเคราะห์สำเร็จ!',
                        text: 'คำแนะนำโภชนาการครบถ้วน',
                        icon: 'success'
                    });
                }
            });
        });
    </script>
</body>
</html>
